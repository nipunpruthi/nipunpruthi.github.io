{{ with .Site.Data.experience.entries }}
<section class="home-section home-experience" id="experience">
  <h2 class="home-section-title">Experience</h2>
  <div class="timeline-wrap">
    <div class="timeline-line" id="timeline-line-home" aria-hidden="true">
      <span class="timeline-line-glow" aria-hidden="true"></span>
      <span class="timeline-line-hover-dot" aria-hidden="true"></span>
    </div>
  <ol class="timeline">
    {{ range . }}
    {{ $e := . }}
    <li class="timeline-item">
      <span class="timeline-marker" aria-hidden="true"></span>
      <div class="timeline-content">
        <div class="timeline-head-row">
          <div class="timeline-head-left">
            {{ with $e.icon }}
            <div class="timeline-company-icon-wrap">
              <img class="timeline-company-icon" src="{{ . | relURL }}" alt="" loading="lazy">
            </div>
            {{ end }}
            <h3 class="timeline-role">
              {{ $e.role }}{{ with $e.company }} @ {{ if $e.company_url }}<a href="{{ $e.company_url }}" target="_blank" rel="noopener" class="timeline-company-link">{{ $e.company }}</a>{{ else }}<span class="timeline-company">{{ $e.company }}</span>{{ end }}{{ end }}
            </h3>
          </div>
          <div class="timeline-period">{{ $e.start }} â€” {{ $e.end }}</div>
        </div>
        {{ if or $e.description $e.location }}
        <div class="timeline-meta-row">
          {{ with $e.description }}<p class="timeline-description">{{ . }}</p>{{ end }}
          {{ with $e.location }}<span class="timeline-location"><span class="timeline-location-icon">{{ partial "icon-pin.html" $ }}</span>{{ . }}</span>{{ end }}
        </div>
        {{ end }}
        {{ with $e.tech }}
        <div class="timeline-tech">
          {{ range . }}<span class="timeline-tag">{{ . }}</span>{{ end }}
        </div>
        {{ end }}
        {{ if $e.more }}
        <details class="timeline-details">
          <summary class="timeline-details-summary">More</summary>
          <div class="timeline-details-content">
            {{ range $e.more }}
            <div class="timeline-project">
              {{ with .name }}<h3 class="timeline-project-name">{{ . }}</h3>{{ end }}
              {{ with .details }}<ul class="timeline-project-details">{{ range . }}<li>{{ . }}</li>{{ end }}</ul>{{ end }}
            </div>
            {{ end }}
          </div>
        </details>
        {{ else if $e.details }}
        <details class="timeline-details">
          <summary class="timeline-details-summary">More</summary>
          <div class="timeline-details-content">{{ $e.details | markdownify }}</div>
        </details>
        {{ end }}
      </div>
    </li>
    {{ end }}
  </ol>
  </div>
  <script>
    (function() {
      var line = document.getElementById('timeline-line-home');
      if (!line) return;
      var wrap = line.closest('.timeline-wrap');
      var dot = line.querySelector('.timeline-line-hover-dot');
      var glow = line.querySelector('.timeline-line-glow');
      if (!wrap || !dot || !glow) return;
      var markers = wrap.querySelectorAll('.timeline-marker');
      function updateGlowSegment(cursorY) {
        var lineRect = line.getBoundingClientRect();
        var lineTop = lineRect.top;
        var lineHeight = lineRect.height;
        var above = 0;
        var below = lineHeight;
        for (var i = 0; i < markers.length; i++) {
          var mr = markers[i].getBoundingClientRect();
          var my = (mr.top + mr.bottom) / 2 - lineTop;
          if (my <= cursorY && my > above) above = my;
          if (my >= cursorY && my < below) below = my;
        }
        glow.style.top = above + 'px';
        glow.style.height = (below - above) + 'px';
      }
      line.addEventListener('mouseenter', function(e) {
        dot.classList.add('is-visible');
        glow.classList.add('is-visible');
        var rect = line.getBoundingClientRect();
        updateGlowSegment(e.clientY - rect.top);
      });
      line.addEventListener('mouseleave', function() {
        dot.classList.remove('is-visible');
        glow.classList.remove('is-visible');
      });
      line.addEventListener('mousemove', function(e) {
        var rect = line.getBoundingClientRect();
        var y = e.clientY - rect.top;
        dot.style.top = y + 'px';
        updateGlowSegment(y);
      });
    })();
  </script>
</section>
{{ end }}
